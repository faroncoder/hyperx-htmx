{% load static %}
{% load htmx_tags %}
{% load django_bootstrap5 %} 
{% bootstrap_css %}
{% bootstrap_javascript %}
<!DOCTYPE html> 
<html lang="en">
    <head>
    <meta charset="UTF-8">
    
  <script type="text/javascript" src="{% static 'js/htmx.min.js' %}"></script>
  <script type ="text/javascript" src="{% static 'js/json_enc.js' %}"></script>
  <script type ="text/javascript" src="{% static 'js/ws.js' %}"></script>
  
  <link type="text/css" href="{% static 'css/simple_datatable.css' %}" rel="stylesheet" />
  <link type="text/css" href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet" />
  <link type="text/css" href="{% static 'css/all.min.css' %}" rel="stylesheet" />
  <link type="text/css" href="{% static 'css/styles.css' %}" rel="stylesheet" />
  <link type="text/css" href="{% static 'css/default.css' %}" rel="stylesheet" />

    <!-- Feather Icons -->

      <script type ="text/javascript" src="{% static 'js/feather.min.js' %}"></script>
        <script type ="text/javascript" src="{% static 'js/loader.js' %}"></script>

</head>
<body>
<!-- Real-time Features Component -->
<div class="row">
    <!-- Live Activity Feed -->
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <div>
                    <h5 class="mb-0">Live Activity Feed</h5>
                    <small class="text-muted">Real-time system events</small>
                </div>
                <div class="d-flex gap-2">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="activity-auto-scroll" checked>
                        <label class="form-check-label" for="activity-auto-scroll">Auto-scroll</label>
                    </div>
                    <button class="btn btn-sm btn-outline-secondary"
                            {% htmx_delete '/declaratives/component/realtime/clear-feed/' %}
                            {% htmx_target '#activity-feed' %}
                            {% htmx_confirm 'Clear all activity?' %}>
                        <i data-feather="trash-2"></i>
                    </button>
                </div>
            </div>
            <div class="card-body p-0">
                <div id="activity-feed" style="height: 400px; overflow-y: auto;"
                     {% htmx_get '/declaratives/component/realtime/activity/' %}
                     {% htmx_trigger 'load, every 2s' %}
                     {% htmx_swap 'afterbegin settle:100ms' %}
                     {% htmx_sync 'this:replace' %}>
                    
                    <!-- Activity items will be prepended here -->
                    <div class="p-4 text-center text-muted">
                        <i data-feather="activity" class="mb-2"></i>
                        <div>Watching for activity...</div>
                        <small>Live events will appear here</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Live Notifications -->
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <div>
                    <h5 class="mb-0">Notifications Center</h5>
                    <small class="text-muted">Instant alerts & messages</small>
                </div>
                <span class="badge bg-primary" id="notification-count"
                      {% htmx_get '/declaratives/component/realtime/notification-count/' %}
                      {% htmx_trigger 'load, every 5s' %}
                      {% htmx_swap 'innerHTML' %}>0</span>
            </div>
            <div class="card-body">
                <!-- Notification Controls -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <select class="form-select form-select-sm"
                                {% htmx_get '/declaratives/component/realtime/notifications/' %}
                                {% htmx_trigger 'change' %}
                                {% htmx_target '#notifications-list' %}
                                name="filter">
                            <option value="all">All Notifications</option>
                            <option value="unread">Unread Only</option>
                            <option value="important">Important</option>
                            <option value="system">System Alerts</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <button class="btn btn-sm btn-success w-100"
                                {% htmx_post '/declaratives/component/realtime/test-notification/' %}
                                {% htmx_target '#notifications-list' %}
                                {% htmx_swap 'afterbegin' %}>
                            <i data-feather="bell"></i> Send Test Notification
                        </button>
                    </div>
                </div>

                <!-- Notifications List -->
                <div id="notifications-list" style="height: 320px; overflow-y: auto;"
                     {% htmx_get '/declaratives/component/realtime/notifications/' %}
                     {% htmx_trigger 'load, every 3s' %}
                     {% htmx_swap 'innerHTML' %}>
                    
                    <!-- Notifications will be loaded here -->
                    <div class="text-center text-muted py-4">
                        <i data-feather="bell-off" class="mb-2"></i>
                        <div>No notifications</div>
                        <small>You're all caught up!</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Live Chat/Messages Demo -->
<div class="row mt-4">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <div>
                    <h5 class="mb-0">Live Messages</h5>
                    <small class="text-muted">Real-time messaging demo</small>
                </div>
                <div class="d-flex align-items-center gap-2">
                    <span class="badge bg-success pulse">
                        <i data-feather="wifi"></i> Live
                    </span>
                    <small class="text-muted">3 online</small>
                </div>
            </div>
            <div class="card-body p-0">
                <!-- Messages Area -->
                <div id="messages-container" style="height: 300px; overflow-y: auto; padding: 1rem;"
                     {% htmx_get '/declaratives/component/realtime/messages/' %}
                     {% htmx_trigger 'load, every 1s' %}
                     {% htmx_swap 'innerHTML' %}>
                    
                    <!-- Messages will be loaded here -->
                    <div class="text-center text-muted">
                        <i data-feather="message-circle" class="mb-2"></i>
                        <div>No messages yet</div>
                        <small>Start a conversation below</small>
                    </div>
                </div>

                <!-- Message Input -->
                <div class="border-top p-3">
                    <form class="d-flex gap-2"
                          {% htmx_post '/declaratives/component/realtime/send-message/' %}
                          {% htmx_target '#messages-container' %}
                          {% htmx_swap 'beforeend' %}
                          {% htmx_on 'htmx:afterRequest' 'this.reset()' %}>
                        
                        <input type="text" class="form-control" name="message" 
                               placeholder="Type a message..." required
                               {% htmx_trigger 'keydown[key==Enter] from:this' %}>
                        <button type="submit" class="btn btn-primary">
                            <i data-feather="send"></i>
                        </button>
                    </form>
                    
                    <div class="mt-2 d-flex justify-content-between align-items-center">
                        <div id="typing-indicator" class="text-muted small">
                            <!-- Typing indicators will appear here -->
                        </div>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="sound-notifications" checked>
                            <label class="form-check-label small" for="sound-notifications">Sound alerts</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Live System Status -->
    <div class="col-lg-4">
        <div class="card h-100">
            <div class="card-header">
                <h6 class="mb-0">System Status</h6>
            </div>
            <div class="card-body">
                <div id="system-status"
                     {% htmx_get '/declaratives/component/realtime/system-status/' %}
                     {% htmx_trigger 'load, every 5s' %}
                     {% htmx_swap 'innerHTML' %}>
                    
                    <!-- System status items -->
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="d-flex align-items-center">
                            <div class="bg-success rounded-circle me-2" style="width: 8px; height: 8px;"></div>
                            <small>Database</small>
                        </div>
                        <small class="text-muted">Operational</small>
                    </div>
                    
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="d-flex align-items-center">
                            <div class="bg-success rounded-circle me-2" style="width: 8px; height: 8px;"></div>
                            <small>API Server</small>
                        </div>
                        <small class="text-muted">Operational</small>
                    </div>
                    
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="d-flex align-items-center">
                            <div class="bg-warning rounded-circle me-2" style="width: 8px; height: 8px;"></div>
                            <small>Cache</small>
                        </div>
                        <small class="text-muted">Degraded</small>
                    </div>
                </div>
                
                <hr>
                
                <!-- Live Counters -->
                <div class="mt-3">
                    <h6 class="small text-muted mb-3">LIVE COUNTERS</h6>
                    
                    <div class="row text-center">
                        <div class="col-6 mb-3">
                            <div class="border rounded p-2">
                                <div id="online-users"
                                     {% htmx_get '/declaratives/component/realtime/online-count/' %}
                                     {% htmx_trigger 'load, every 2s' %}
                                     {% htmx_swap 'innerHTML' %}
                                     class="h5 mb-0 text-success">0</div>
                                <small class="text-muted">Online</small>
                            </div>
                        </div>
                        <div class="col-6 mb-3">
                            <div class="border rounded p-2">
                                <div id="active-sessions"
                                     {% htmx_get '/declaratives/component/realtime/sessions-count/' %}
                                     {% htmx_trigger 'load, every 2s' %}
                                     {% htmx_swap 'innerHTML' %}
                                     class="h5 mb-0 text-primary">0</div>
                                <small class="text-muted">Sessions</small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Server Uptime -->
                <div class="mt-3 pt-3 border-top">
                    <div class="d-flex justify-content-between align-items-center">
                        <small class="text-muted">Server Uptime</small>
                        <div id="server-uptime"
                             {% htmx_get '/declaratives/component/realtime/uptime/' %}
                             {% htmx_trigger 'load, every 10s' %}
                             {% htmx_swap 'innerHTML' %}
                             class="badge bg-light text-dark">00:00:00</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Live Progress Indicators -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Live Progress Tracking</h5>
                <small class="text-muted">Real-time progress bars and indicators</small>
            </div>
            <div class="card-body">
                <div class="row">
                    <!-- File Upload Progress -->
                    <div class="col-md-4 mb-4">
                        <h6>File Upload Simulation</h6>
                        <div id="upload-progress"
                             {% htmx_get '/declaratives/component/realtime/upload-progress/' %}
                             {% htmx_trigger 'load' %}>
                            
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <small>document.pdf</small>
                                <small class="text-muted">0%</small>
                            </div>
                            <div class="progress mb-2" style="height: 8px;">
                                <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                            </div>
                            <button class="btn btn-sm btn-primary w-100"
                                    {% htmx_post '/declaratives/component/realtime/start-upload/' %}
                                    {% htmx_target '#upload-progress' %}
                                    {% htmx_swap 'innerHTML' %}>
                                Start Upload
                            </button>
                        </div>
                    </div>

                    <!-- Data Processing -->
                    <div class="col-md-4 mb-4">
                        <h6>Data Processing</h6>
                        <div id="processing-progress"
                             {% htmx_get '/declaratives/component/realtime/processing-progress/' %}
                             {% htmx_trigger 'load' %}>
                            
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <small>Processing records...</small>
                                <small class="text-muted">Idle</small>
                            </div>
                            <div class="progress mb-2" style="height: 8px;">
                                <div class="progress-bar bg-success" role="progressbar" style="width: 0%"></div>
                            </div>
                            <button class="btn btn-sm btn-success w-100"
                                    {% htmx_post '/declaratives/component/realtime/start-processing/' %}
                                    {% htmx_target '#processing-progress' %}
                                    {% htmx_swap 'innerHTML' %}>
                                Start Processing
                            </button>
                        </div>
                    </div>

                    <!-- System Health -->
                    <div class="col-md-4 mb-4">
                        <h6>System Health Score</h6>
                        <div id="health-score"
                             {% htmx_get '/declaratives/component/realtime/health-score/' %}
                             {% htmx_trigger 'load, every 3s' %}
                             {% htmx_swap 'innerHTML' %}>
                            
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <small>Overall Health</small>
                                <small class="text-success">95%</small>
                            </div>
                            <div class="progress mb-2" style="height: 8px;">
                                <div class="progress-bar bg-success" role="progressbar" style="width: 95%"></div>
                            </div>
                            <small class="text-muted">All systems operational</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Pulse animation for live indicators */
.pulse {
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
}

/* Smooth transitions for live updates */
#activity-feed .activity-item,
#notifications-list .notification-item,
#messages-container .message-item {
    transition: all 0.3s ease;
}

/* Auto-scroll behavior */
#activity-feed[data-auto-scroll="true"] {
    scroll-behavior: smooth;
}
</style>



  <script type="text/javascript" src="{% static 'js/htmx_client.js' %}" defer></script>
  <script type="text/javascript" src="{% static 'js/localStorage.min.js' %}" id="localStorageScript"
    onload="window.localStorageReady = true; console.log('âœ… localStorage.min.js loaded');"></script>
  <script type="text/javascript" src="{% static 'js/bootstrap.bundle.min.js' %}"></script> 
  <script type="text/javascript" src="{% static 'js/base_start.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/toasts.js' %}"></script>



<script>
// Auto-scroll functionality for activity feed
document.getElementById('activity-auto-scroll').addEventListener('change', function() {
    const feed = document.getElementById('activity-feed');
    if (this.checked) {
        feed.setAttribute('data-auto-scroll', 'true');
        // Scroll to bottom when new items are added
        const observer = new MutationObserver(function() {
            if (document.getElementById('activity-auto-scroll').checked) {
                feed.scrollTop = feed.scrollHeight;
            }
        });
        observer.observe(feed, { childList: true });
    } else {
        feed.removeAttribute('data-auto-scroll');
    }
});

// Sound notification function
function playNotificationSound() {
    if (document.getElementById('sound-notifications').checked) {
        // Create a simple beep sound (in a real app, you'd use actual audio files)
        const context = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = context.createOscillator();
        const gainNode = context.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(context.destination);
        
        oscillator.frequency.value = 800;
        gainNode.gain.setValueAtTime(0.3, context.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, context.currentTime + 0.3);
        
        oscillator.start();
        oscillator.stop(context.currentTime + 0.3);
    }
}

// Listen for new messages and play sound
document.body.addEventListener('htmx:afterSwap', function(event) {
    if (event.target.id === 'messages-container') {
        playNotificationSound();
    }
    
    // Re-initialize Feather icons
    feather.replace();
});

// Auto-scroll messages to bottom
document.body.addEventListener('htmx:afterSwap', function(event) {
    if (event.target.id === 'messages-container') {
        const container = event.target;
        container.scrollTop = container.scrollHeight;
    }
});

// Typing indicator simulation
let typingTimer;
document.querySelector('input[name="message"]')?.addEventListener('keyup', function() {
    const indicator = document.getElementById('typing-indicator');
    indicator.textContent = 'You are typing...';
    
    clearTimeout(typingTimer);
    typingTimer = setTimeout(() => {
        indicator.textContent = '';
    }, 2000);
});
</script>



{% bootstrap_javascript %}
</body>
</html>
