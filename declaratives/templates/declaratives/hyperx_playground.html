{% load static %}
{% load htmx_tags %}
{% load django_bootstrap5 %} 
{% bootstrap_css %}
{% bootstrap_javascript %}
<!DOCTYPE html> 
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page_title }}</title>
     <script type="text/javascript" src="{% static 'js/htmx.min.js' %}"></script>
  <script type ="text/javascript" src="{% static 'js/json_enc.js' %}"></script>
  <script type ="text/javascript" src="{% static 'js/ws.js' %}"></script>
  
  <link type="text/css" href="{% static 'css/simple_datatable.css' %}" rel="stylesheet" />
      <link type="text/css" href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet" />
  <link type="text/css" href="{% static 'css/all.min.css' %}" rel="stylesheet" />
  <link type="text/css" href="{% static 'css/styles.css' %}" rel="stylesheet" />
  <link type="text/css" href="{% static 'css/default.css' %}" rel="stylesheet" />

    <!-- Feather Icons -->

      <script type ="text/javascript" src="{% static 'js/feather.min.js' %}"></script>
        <script type ="text/javascript" src="{% static 'js/loader.js' %}"></script>
    <!-- Monaco Editor for Code Testing -->

    
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .playground-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        
        .endpoint-card {
            border: none;
            border-radius: 15px;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }
        
        .endpoint-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            border-left-color: #007bff;
        }
        
        .endpoint-link {
            text-decoration: none;
            color: inherit;
            display: block;
        }
        
        .endpoint-link:hover {
            color: inherit;
        }
        
        .status-badge {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .code-editor {
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid #e9ecef;
        }
        
        .output-panel {
            background: #1e1e1e;
            color: #d4d4d4;
            border-radius: 10px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            min-height: 300px;
            overflow-y: auto;
        }
        
        .htmx-indicator {
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .htmx-request .htmx-indicator {
            opacity: 1;
        }
        
        .feature-highlight {
            background: linear-gradient(45deg, #ff6b6b, #ffd93d);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: bold;
        }
    </style>
</head>

<body {% htmx_boost_links %}>
    <div class="container-fluid py-5">
        <div class="playground-container p-4">
            
            <!-- Header -->
            <div class="text-center mb-5">
                <h1 class="display-4 mb-3">
                    ðŸ§ª <span class="feature-highlight">HyperX Playground</span>
                </h1>
                <p class="lead">Interactive testing environment for advanced URL patterns & components</p>
                <div class="d-flex justify-content-center gap-3">
                    <span class="badge bg-success status-badge">
                        <i data-feather="wifi"></i> Live System
                    </span>
                    <span class="badge bg-info">
                        <i data-feather="zap"></i> HTMX Powered
                    </span>
                    <span class="badge bg-warning text-dark">
                        <i data-feather="code"></i> Advanced Patterns
                    </span>
                </div>
            </div>

            <div class="row">
                <!-- Left Panel - Endpoint Explorer -->
                <div class="col-lg-6">
                    <div class="card h-100">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">
                                <i data-feather="map"></i> Endpoint Explorer
                            </h5>
                        </div>
                        <div class="card-body">
                            {% for category, endpoint_list in endpoints.items %}
                                {% if endpoint_list %}
                                <h6 class="text-muted mt-4 mb-3">{{ category }}</h6>
                                <div class="row">
                                    {% for name, url in endpoint_list %}
                                    <div class="col-md-6 mb-3">
                                        <div class="endpoint-card card">
                                            <div class="card-body p-3">
                                                <a href="#" class="endpoint-link"
                                                   {% htmx_get url %}
                                                   {% htmx_target '#output-container' %}
                                                   hx-indicator="#loading-spinner">
                                                    <h6 class="card-title mb-2">{{ name }}</h6>
                                                    <code class="small text-muted">{{ url }}</code>
                                                    <div class="mt-2">
                                                        <span class="badge bg-light text-dark">GET</span>
                                                        <span class="badge bg-success">HTMX</span>
                                                    </div>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                                {% endif %}
                            {% endfor %}
                            
                            <!-- Manual URL Testing -->
                            <div class="mt-4 pt-4 border-top">
                                <h6 class="text-muted mb-3">Manual URL Testing</h6>
                                <form class="row g-2"
                                      {% htmx_get '' %}
                                      {% htmx_target '#output-container' %}
                                      hx-indicator="#loading-spinner">
                                    
                                    <div class="col-md-8">
                                        <input type="url" class="form-control" 
                                               name="test_url" 
                                               placeholder="/declaratives/component/..."
                                               {% htmx_trigger 'keyup[key==Enter]' %}
                                               {% htmx_get '' %}
                                               {% htmx_target '#output-container' %}
                                               hx-include="this">
                                    </div>
                                    <div class="col-md-4">
                                        <button type="submit" class="btn btn-primary w-100">
                                            <i data-feather="send"></i> Test
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Panel - Output & Results -->
                <div class="col-lg-6">
                    <div class="card h-100">
                        <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">
                                <i data-feather="monitor"></i> Response Output
                            </h5>
                            <div id="loading-spinner" class="htmx-indicator">
                                <div class="spinner-border spinner-border-sm" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div id="output-container" class="output-panel p-4">
                                <div class="text-center text-muted py-5">
                                    <i data-feather="play-circle" size="48" class="mb-3"></i>
                                    <h6>Ready to test endpoints</h6>
                                    <p class="small mb-0">Click any endpoint above to see the response</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Advanced Features Section -->
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">
                                <i data-feather="settings"></i> Advanced URL Pattern Features
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <!-- Dynamic Component Loading -->
                                <div class="col-lg-4 mb-4">
                                    <h6 class="text-primary">Dynamic Component Loading</h6>
                                    <p class="small text-muted mb-3">
                                        Test regex-based dynamic component patterns
                                    </p>
                                    <div class="input-group mb-2">
                                        <span class="input-group-text">/dynamic/</span>
                                        <input type="text" class="form-control" value="form" disabled>
                                        <span class="input-group-text">/</span>
                                        <input type="text" class="form-control" 
                                               placeholder="component-id"
                                               id="dynamic-id">
                                        <span class="input-group-text">/</span>
                                    </div>
                                    <button class="btn btn-outline-primary btn-sm w-100"
                                            onclick="testDynamicComponent()">
                                        <i data-feather="zap"></i> Test Dynamic Loading
                                    </button>
                                </div>

                                <!-- REST API Testing -->
                                <div class="col-lg-4 mb-4">
                                    <h6 class="text-success">RESTful API Patterns</h6>
                                    <p class="small text-muted mb-3">
                                        Test RESTful endpoints with different resources
                                    </p>
                                    <select class="form-select mb-2" id="rest-resource">
                                        <option value="tasks">Tasks</option>
                                        <option value="users">Users</option>
                                        <option value="comments">Comments</option>
                                        <option value="metrics">Metrics</option>
                                    </select>
                                    <button class="btn btn-outline-success btn-sm w-100"
                                            onclick="testRestAPI()">
                                        <i data-feather="database"></i> Test REST API
                                    </button>
                                </div>

                                <!-- SSE Stream Testing -->
                                <div class="col-lg-4 mb-4">
                                    <h6 class="text-warning">Server-Sent Events</h6>
                                    <p class="small text-muted mb-3">
                                        Test real-time streaming patterns
                                    </p>
                                    <select class="form-select mb-2" id="sse-channel">
                                        <option value="notifications">Notifications</option>
                                        <option value="messages">Messages</option>
                                        <option value="system-status">System Status</option>
                                        <option value="live-metrics">Live Metrics</option>
                                    </select>
                                    <button class="btn btn-outline-warning btn-sm w-100"
                                            onclick="testSSEStream()">
                                        <i data-feather="radio"></i> Test SSE Stream
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer with Navigation -->
            <div class="text-center mt-5 pt-4 border-top">
                <div class="btn-group" role="group">
                    <a href="{% url 'declaratives:showcase_home' %}" class="btn btn-outline-primary" hx-boost="false">
                        <i data-feather="home"></i> Showcase Home
                    </a>
                    <a href="{% url 'declaratives:component_gallery' %}" class="btn btn-outline-success" hx-boost="false">
                        <i data-feather="grid"></i> Component Gallery  
                    </a>
                    <button class="btn btn-outline-info" onclick="clearOutput()">
                        <i data-feather="trash-2"></i> Clear Output
                    </button>
                    <button class="btn btn-outline-warning" onclick="exportResults()">
                        <i data-feather="download"></i> Export Results
                    </button>
                </div>
            </div>
        </div>
    </div>




  <script type="text/javascript" src="{% static 'js/htmx_client.js' %}" defer></script>
  <script type="text/javascript" src="{% static 'js/localStorage.min.js' %}" id="localStorageScript"
    onload="window.localStorageReady = true; console.log('âœ… localStorage.min.js loaded');"></script>
  <script type="text/javascript" src="{% static 'js/bootstrap.bundle.min.js' %}"></script> 
  <script type="text/javascript" src="{% static 'js/base_start.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/toasts.js' %}"></script>



    <script>
        // Initialize Feather icons
        feather.replace();

        // Re-initialize icons after HTMX swaps
        document.body.addEventListener('htmx:afterSwap', function(event) {
            feather.replace();
        });

        // Dynamic component testing
        function testDynamicComponent() {
            const componentId = document.getElementById('dynamic-id').value || 'user-profile';
            const url = `/declaratives/dynamic/form/${componentId}/`;
            
            htmx.ajax('GET', url, {
                target: '#output-container',
                indicator: '#loading-spinner'
            });
        }

        // REST API testing  
        function testRestAPI() {
            const resource = document.getElementById('rest-resource').value;
            const url = `/declaratives/rest/${resource}/`;
            
            htmx.ajax('GET', url, {
                target: '#output-container', 
                indicator: '#loading-spinner'
            });
        }

        // SSE Stream testing
        function testSSEStream() {
            const channel = document.getElementById('sse-channel').value;
            const url = `/declaratives/stream/${channel}/`;
            
            htmx.ajax('GET', url, {
                target: '#output-container',
                indicator: '#loading-spinner'
            });
        }

        // Clear output
        function clearOutput() {
            document.getElementById('output-container').innerHTML = `
                <div class="text-center text-muted py-5">
                    <i data-feather="play-circle" size="48" class="mb-3"></i>
                    <h6>Ready to test endpoints</h6>
                    <p class="small mb-0">Output cleared - click any endpoint to see new results</p>
                </div>
            `;
            feather.replace();
        }

        // Export results
        function exportResults() {
            const output = document.getElementById('output-container').innerHTML;
            const blob = new Blob([output], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'hyperx-playground-results.html';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Handle manual URL testing
        document.querySelector('input[name="test_url"]').addEventListener('input', function(e) {
            if (e.target.value) {
                // Update the HTMX GET attribute dynamically
                e.target.setAttribute('hx-get', e.target.value);
                htmx.process(e.target);
            }
        });

        // Enhanced error handling
        document.body.addEventListener('htmx:responseError', function(event) {
            document.getElementById('output-container').innerHTML = `
                <div class="alert alert-danger m-3">
                    <h6><i data-feather="alert-triangle"></i> Error ${event.detail.xhr.status}</h6>
                    <p class="mb-0">${event.detail.xhr.statusText}</p>
                    <small class="text-muted">URL: ${event.detail.pathInfo.requestPath}</small>
                </div>
            `;
            feather.replace();
        });

        // Success feedback
        document.body.addEventListener('htmx:afterSwap', function(event) {
            if (event.target.id === 'output-container') {
                // Add success feedback to the output
                const timestamp = new Date().toLocaleTimeString();
                const successBadge = `
                    <div class="alert alert-success alert-dismissible fade show m-3">
                        <i data-feather="check-circle"></i> 
                        <strong>Success!</strong> Response loaded at ${timestamp}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                `;
                event.target.insertAdjacentHTML('afterbegin', successBadge);
                feather.replace();
            }
        });
    </script>

    {% htmx_debug %}

{% bootstrap_javascript %}
</body>
</html>
